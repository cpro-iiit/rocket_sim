# Project Structure Guide

Complete directory organization and file descriptions for the N-Body Rocket Simulation project.

## ğŸ“ Directory Tree

```
nbody-simulation/
â”‚
â”œâ”€â”€ ğŸ“„ Makefile                         # Build system configuration
â”œâ”€â”€ ğŸ“„ README.md                        # Main documentation
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md             # This file
â”‚
â”œâ”€â”€ ğŸ“‚ include/                         # Header files
â”‚   â””â”€â”€ nbody.h                         # Main header (structures, constants, prototypes)
â”‚
â”œâ”€â”€ ğŸ“‚ src/                             # Core source files
â”‚   â”œâ”€â”€ main.c                          # Program entry point and main loop
â”‚   â”œâ”€â”€ bmp_io.c                        # BMP image file operations
â”‚   â”œâ”€â”€ file_io.c                       # Configuration and data I/O
â”‚   â”œâ”€â”€ init.c                          # Default initialization
â”‚   â”œâ”€â”€ physics.c                       # Physics simulation engine
â”‚   â””â”€â”€ render.c                        # Visualization rendering
â”‚
â”œâ”€â”€ ğŸ“‚ tools/                           # Utility programs
â”‚   â”œâ”€â”€ analyze_trails.c                # Binary trajectory analyzer
â”‚   â””â”€â”€ plot_trails.c                   # Trajectory visualization tool
â”‚
â”œâ”€â”€ ğŸ“‚ test/                            # Test suite
â”‚   â”œâ”€â”€ test_physics.c                  # Physics module tests
â”‚   â”œâ”€â”€ test_file_io.c                  # File I/O tests
â”‚   â”œâ”€â”€ test_integration.c              # End-to-end tests
â”‚   â””â”€â”€ test_data/                      # Test data files (generated)
â”‚       â”œâ”€â”€ test_bodies.txt
â”‚       â”œâ”€â”€ test_rockets.txt
â”‚       â””â”€â”€ test_config.txt
â”‚
â”œâ”€â”€ ğŸ“‚ config/                          # Configuration files (optional)
â”‚   â”œâ”€â”€ config.txt                      # Simulation parameters
â”‚   â”œâ”€â”€ bodies.txt                      # Celestial body definitions
â”‚   â””â”€â”€ rockets.txt                     # Rocket initial conditions
â”‚
â”œâ”€â”€ ğŸ“‚ obj/                             # Object files (generated by make)
â”‚   â”œâ”€â”€ main.o
â”‚   â”œâ”€â”€ bmp_io.o
â”‚   â”œâ”€â”€ file_io.o
â”‚   â”œâ”€â”€ init.o
â”‚   â”œâ”€â”€ physics.o
â”‚   â”œâ”€â”€ render.o
â”‚   â”œâ”€â”€ analyze_trails.o
â”‚   â”œâ”€â”€ plot_trails.o
â”‚   â”œâ”€â”€ test_physics.o
â”‚   â”œâ”€â”€ test_file_io.o
â”‚   â””â”€â”€ test_integration.o
â”‚
â”œâ”€â”€ ğŸ“‚ bin/                             # Executables (generated by make)
â”‚   â”œâ”€â”€ nbody                           # Main simulation
â”‚   â”œâ”€â”€ analyze_trails                  # Analysis tool
â”‚   â”œâ”€â”€ plot_trails                     # Plotting tool
â”‚   â”œâ”€â”€ test_physics                    # Physics tests
â”‚   â”œâ”€â”€ test_file_io                    # File I/O tests
â”‚   â””â”€â”€ test_integration                # Integration tests
â”‚
â””â”€â”€ ğŸ“‚ output/                          # Simulation outputs (generated by program)
    â”œâ”€â”€ frame_0000.bmp
    â”œâ”€â”€ frame_0001.bmp
    â”œâ”€â”€ ...
    â”œâ”€â”€ final_rockets.txt
    â”œâ”€â”€ rocket_trails.bin
    â”œâ”€â”€ rocket_stats.csv
    â”œâ”€â”€ frames.log
    â”œâ”€â”€ metadata.txt
    â””â”€â”€ plotted_trails.bmp
```

## ğŸ“‹ File Descriptions

### Header Files (include/)

#### nbody.h
**Purpose**: Central header file for the entire project  
**Contains**:
- Data structure definitions (Body, Rocket, Pixel, SimConfig)
- Simulation constants and parameters
- Function prototypes for all modules
- Standard library includes

**Dependencies**: None  
**Included by**: All .c files

---

### Core Source Files (src/)

#### main.c
**Purpose**: Program entry point and main simulation loop  
**Functions**:
- `main()` - Entry point, user interaction, orchestration
- Coordinates initialization, simulation, and output

**Dependencies**: All other modules  
**Size**: ~120 lines

#### bmp_io.c
**Purpose**: BMP image file I/O operations  
**Functions**:
- `write_bmp()` - Write 24-bit BMP files
- Handles row padding and byte ordering

**Dependencies**: nbody.h  
**Size**: ~60 lines

#### file_io.c
**Purpose**: Configuration and data file operations  
**Functions**:
- `load_bodies()` - Parse body definitions from text
- `load_rockets()` - Parse rocket initial conditions
- `load_config()` - Parse simulation parameters
- `save_rocket_data()` - Export final states (text)
- `save_rocket_trails_bin()` - Save trajectories (binary)
- `save_trajectory_stats()` - Generate CSV statistics
- `save_metadata()` - Record simulation parameters

**Dependencies**: nbody.h  
**Size**: ~200 lines

#### init.c
**Purpose**: Default initialization routines  
**Functions**:
- `init_bodies_default()` - Create default solar system
- `init_rockets_default()` - Create default elliptical orbit

**Dependencies**: nbody.h  
**Size**: ~80 lines

#### physics.c
**Purpose**: Physics simulation and numerical integration  
**Functions**:
- `compute_forces()` - N-body gravitational forces
- `compute_rocket_forces()` - Forces on test particles
- `update_bodies()` - Leapfrog integration for bodies
- `update_rockets()` - Integration for rockets with trail recording

**Dependencies**: nbody.h  
**Size**: ~150 lines

#### render.c
**Purpose**: Convert simulation state to visual representation  
**Functions**:
- `render()` - Main rendering function
- `draw_line()` - Bresenham line algorithm (static)
- `draw_circle()` - Filled circle rendering (static)

**Dependencies**: nbody.h  
**Size**: ~180 lines

---

### Analysis Tools (tools/)

#### analyze_trails.c
**Purpose**: Standalone trajectory analysis program  
**Functions**:
- `main()` - Read binary trails and compute statistics
- Calculates distances, path lengths, bounding boxes
- Generates console reports

**Dependencies**: Standard libraries only  
**Size**: ~120 lines  
**Output**: Console statistics

#### plot_trails.c
**Purpose**: Standalone trajectory visualization  
**Functions**:
- `main()` - Read binary trails and render to BMP
- `draw_line()` - Line drawing
- `draw_circle()` - Circle drawing
- `write_bmp()` - BMP output

**Dependencies**: Standard libraries only  
**Size**: ~250 lines  
**Output**: BMP image file

---

### Test Suite (test/)

#### test_physics.c
**Purpose**: Unit tests for physics module  
**Tests**:
- Two-body force calculations
- Newton's third law verification
- Circular orbit stability
- Energy conservation
- Rocket gravitational forces
- Multi-body systems

**Dependencies**: Physics module, init module  
**Size**: ~180 lines  
**Test Count**: 6 tests

#### test_file_io.c
**Purpose**: Unit tests for file I/O operations  
**Tests**:
- Load bodies from file
- Load rockets from file
- Load configuration
- Handle missing files gracefully
- Binary trajectory save/load
- Text format output
- Comment and whitespace handling
- Parameter validation

**Dependencies**: File I/O module, init module  
**Size**: ~250 lines  
**Test Count**: 8 tests

#### test_integration.c
**Purpose**: End-to-end integration tests  
**Tests**:
- Complete simulation workflow
- Kepler's third law verification
- Momentum conservation
- Rocket trajectory accuracy
- Multiple rockets independence
- File I/O round-trip consistency
- Escape velocity verification

**Dependencies**: All modules  
**Size**: ~280 lines  
**Test Count**: 7 tests

---

### Configuration Files (config/)

#### config.txt
**Format**: Key=Value pairs  
**Parameters**:
```
dt=0.01           # Time step
steps=5000        # Total simulation steps
frames=100        # Number of output frames
save_interval=50  # Steps between frames
g=1.0             # Gravitational constant
```

#### bodies.txt
**Format**: Space-separated columns  
**Columns**: `x y vx vy mass`  
**Example**:
```
# x    y    vx   vy   mass
0.0   0.0  0.0  0.0  100.0   # Central star
2.0   0.0  0.0  0.707  5.0   # Planet 1
```

#### rockets.txt
**Format**: Space-separated columns  
**Columns**: `x y vx vy`  
**Example**:
```
# x     y    vx      vy
2.0    0.0  0.0     1.732    # Elliptical orbit
-8.0  -6.0  1.44    1.08     # Hyperbolic
```

---

## ğŸ”§ Build System

### Makefile Targets

**Build Targets**:
- `make` / `make all` - Build all executables
- `make build-tests` - Build test suite only
- `make clean` - Remove build artifacts
- `make clean-output` - Remove simulation outputs
- `make clean-all` - Full clean
- `make rebuild` - Clean and rebuild

**Execution Targets**:
- `make run` - Build and run simulation
- `make test` - Run all tests
- `make analyze` - Run trajectory analysis
- `make plot` - Generate trajectory plot

**Setup Targets**:
- `make init-config` - Create sample config files
- `make install` - Install to system
- `make uninstall` - Remove from system

**Utility Targets**:
- `make help` - Show all targets
- `make check` - Verify dependencies
- `make debug` - Show Makefile variables
- `make stats` - Show project statistics

---

## ğŸ“Š Output Files

### Visualization
- `frame_XXXX.bmp` - Animation frames (800x800, 24-bit)
- `plotted_trails.bmp` - Post-processed trajectory plot

### Data Files
- `final_rockets.txt` - Final rocket states (text)
- `rocket_trails.bin` - Complete trajectories (binary)
- `rocket_stats.csv` - Statistical summary (CSV)

### Logs
- `frames.log` - Frame generation timestamps
- `metadata.txt` - Simulation parameters

---

## ğŸ”„ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Config Filesâ”‚
â”‚ (optional)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initialize  â”‚â”€â”€â”€â”€â†’â”‚ Simulate â”‚
â”‚ (init.c)    â”‚     â”‚(physics.c)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚         â”‚
                    â†“         â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  Render  â”‚ â”‚  Save  â”‚
             â”‚(render.c)â”‚ â”‚(file_io)â”‚
             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                  â”‚            â”‚
                  â†“            â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   BMP    â”‚ â”‚  Data    â”‚
            â”‚  Images  â”‚ â”‚  Files   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Analysis â”‚
                        â”‚  Tools   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Testing Strategy

### Test Levels

1. **Unit Tests** (test_physics.c, test_file_io.c)
   - Individual function verification
   - Edge case handling
   - Input validation

2. **Integration Tests** (test_integration.c)
   - Module interaction
   - End-to-end workflows
   - Physical law verification

3. **Manual Testing**
   - Visual inspection of trajectories
   - Performance benchmarking
   - Configuration validation

### Running Tests

```bash
# All tests
make test

# Individual test suites
./bin/test_physics
./bin/test_file_io
./bin/test_integration

# With verbose output
./bin/test_physics -v
```

---

## ğŸ“ Code Organization Principles

1. **Separation of Concerns**
   - Each module has single responsibility
   - Clear interfaces through header file
   - Minimal coupling between modules

2. **Header Organization**
   - Single nbody.h for all shared definitions
   - Guards against multiple inclusion
   - Logical grouping of declarations

3. **Build System**
   - Automatic dependency tracking
   - Parallel compilation support
   - Clear separation of build artifacts

4. **Testing**
   - Tests use production code
   - No test code in production modules
   - Comprehensive coverage

---

## ğŸš€ Getting Started

### Initial Setup
```bash
# 1. Build everything
make

# 2. Create sample config files
make init-config

# 3. Run tests to verify
make test

# 4. Run simulation
make run

# 5. Analyze results
make analyze
make plot
```

### Directory Creation
All necessary directories are created automatically by the Makefile:
- `obj/` - Created on first build
- `bin/` - Created on first build
- `config/` - Created by `make init-config`
- `output/` - Created by simulation
- `test/test_data/` - Created by tests

---

## ğŸ“– Further Reading

- See README.md for usage documentation
- See source files for implementation details
- See test files for usage examples
- Run `make help` for build system info